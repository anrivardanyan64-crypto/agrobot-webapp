<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: var(--tg-theme-bg-color, #f5f5f5);
            text-align: center;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            width: 80%;
            max-width: 300px;
        }
        .info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        .debug {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üì± –¢–µ—Å—Ç Web App</h1>
    
    <div class="info">
        <h3>–°—Ç–∞—Ç—É—Å:</h3>
        <p id="status">‚è≥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</p>
        <p id="tg-version"></p>
        <p id="user-info"></p>
    </div>
    
    <button onclick="sendTestData()">üì§ 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç</button>
    <button onclick="testMainButton()">üîò 2. –¢–µ—Å—Ç MainButton</button>
    <button onclick="showDebug()">üîç 3. –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–∫—É</button>
    <button onclick="closeApp()">‚ùå 4. –ó–∞–∫—Ä—ã—Ç—å</button>
    
    <div id="debug" class="debug" style="display: none;">
        <h4>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h4>
        <pre id="debug-output"></pre>
    </div>

    <script>
        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        function log(message) {
            console.log(message);
            const debugOutput = document.getElementById('debug-output');
            if (debugOutput) {
                debugOutput.innerHTML += message + '\n';
            }
        }
        
        log('–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram Web App
        if (!window.Telegram || !window.Telegram.WebApp) {
            document.getElementById('status').innerHTML = '‚ùå Telegram Web App –Ω–µ –Ω–∞–π–¥–µ–Ω!';
            log('‚ùå Telegram Web App –Ω–µ –Ω–∞–π–¥–µ–Ω');
        } else {
            log('‚úÖ Telegram Web App –Ω–∞–π–¥–µ–Ω');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            const tg = window.Telegram.WebApp;
            document.getElementById('tg-version').innerHTML = `–í–µ—Ä—Å–∏—è: ${tg.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`;
            
            try {
                tg.expand();
                log('‚úÖ expand() –≤—ã–ø–æ–ª–Ω–µ–Ω');
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const initData = tg.initData;
                const initDataUnsafe = tg.initDataUnsafe;
                
                log('initData: ' + (initData ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'));
                log('initDataUnsafe: ' + (initDataUnsafe ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'));
                
                if (initDataUnsafe && initDataUnsafe.user) {
                    const user = initDataUnsafe.user;
                    document.getElementById('user-info').innerHTML = 
                        `üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name} ${user.last_name || ''}<br>` +
                        `üÜî ID: ${user.id}<br>` +
                        `üë§ Username: ${user.username || '–Ω–µ—Ç'}`;
                    log(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.first_name} (ID: ${user.id})`);
                } else {
                    document.getElementById('user-info').innerHTML = '‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ';
                    log('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ');
                }
                
                document.getElementById('status').innerHTML = '‚úÖ Web App –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ';
                
            } catch (e) {
                document.getElementById('status').innerHTML = '‚ùå –û—à–∏–±–∫–∞: ' + e.message;
                log('‚ùå –û—à–∏–±–∫–∞: ' + e.message);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function sendTestData() {
            log('sendTestData() –≤—ã–∑–≤–∞–Ω–∞');
            
            if (!window.Telegram || !window.Telegram.WebApp) {
                alert('‚ùå Telegram Web App –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }
            
            const tg = window.Telegram.WebApp;
            
            const testData = {
                type: 'test',
                user_id: tg.initDataUnsafe?.user?.id,
                message: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
                time: new Date().toISOString(),
                test_number: Math.floor(Math.random() * 1000)
            };
            
            log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ: ' + JSON.stringify(testData));
            
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
                tg.showAlert('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç
                tg.sendData(JSON.stringify(testData));
                
                log('‚úÖ sendData() –≤—ã–ø–æ–ª–Ω–µ–Ω');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                tg.showAlert('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±–æ—Ç–∞');
                
            } catch (e) {
                log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ' + e.message);
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
        }
        
        // –¢–µ—Å—Ç MainButton
        function testMainButton() {
            log('testMainButton() –≤—ã–∑–≤–∞–Ω–∞');
            
            if (!window.Telegram || !window.Telegram.WebApp) {
                alert('‚ùå Telegram Web App –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }
            
            const tg = window.Telegram.WebApp;
            
            tg.MainButton.setText("–¢–ï–°–¢–û–í–ê–Ø –ö–ù–û–ü–ö–ê");
            tg.MainButton.onClick(function() {
                log('MainButton –Ω–∞–∂–∞—Ç–∞');
                sendTestData();
            });
            tg.MainButton.show();
            
            tg.showAlert('‚úÖ MainButton –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–ª–∞–¥–∫—É
        function showDebug() {
            const debugDiv = document.getElementById('debug');
            if (debugDiv.style.display === 'none') {
                debugDiv.style.display = 'block';
            } else {
                debugDiv.style.display = 'none';
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å
        function closeApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.close();
            }
        }
    </script>
</body>
</html>
